<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ExteraClicker</title>

<link rel="icon" href="extera.png">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
  :root{
    --primary: #E83030;
    --primary-2: #ff5446;
    --muted: rgba(255,255,255,0.82);
    --nav-height: 72px;
  }

  html,body{
    height:100%;
    margin:0;
    font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    background: linear-gradient(160deg, #8f1111 0%, var(--primary) 40%, var(--primary-2) 80%);
    color:#fff;
    user-select:none;
    -webkit-user-select:none;
    touch-action: manipulation;
    overflow:auto;
    padding-bottom: calc(var(--nav-height) + 20px);
  }

  .app {
    width:100%;
    max-width:980px;
    margin:18px auto;
    border-radius:16px;
    background: linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.10));
    box-shadow: 0 12px 48px rgba(0,0,0,0.45);
    overflow: auto;
    max-height: calc(100vh - 36px);
  }

  .top {
    padding:14px 16px;
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    background: linear-gradient(90deg, rgba(0,0,0,0.12), rgba(0,0,0,0.06));
    position: sticky;
    top: 0;
    z-index: 3;
    backdrop-filter: blur(6px);
  }
  .brand { display:flex; gap:10px; align-items:center; }
  .brand img { width:40px; height:40px; border-radius:8px; object-fit:cover; box-shadow:0 6px 18px rgba(0,0,0,0.4); }
  .brand .title { font-weight:800; font-size:1.05rem; color:#fff; }
  .top-cards { display:flex; gap:10px; align-items:center; }
  .card { min-width:100px; background:rgba(255,255,255,0.04); border-radius:12px; padding:8px 10px; display:flex; flex-direction:column; gap:4px; }
  .card small { font-size:12px; color:var(--muted); }
  .card b { font-size:14px; color:#fff; }

  .main {
    padding:22px 18px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:14px;
  }

  .coin-row {
    display:flex;
    align-items:center;
    gap:10px;
    font-size:1.6rem;
    font-weight:800;
    color:#fff;
    text-shadow: 0 6px 20px rgba(0,0,0,0.4);
  }
  .coin-row img { width:36px; height:36px; }

  .target-wrap {
    position: relative;
    display:flex;
    align-items:center;
    justify-content:center;
    width:100%;
    padding:10px 0 24px 0;
  }

  .target-ring {
    position:absolute;
    width: clamp(210px, 44vw, 360px);
    height: clamp(210px, 44vw, 360px);
    border-radius:50%;
    z-index:0;
    background: radial-gradient(circle at 40% 35%, rgba(255,255,255,0.06) 0%, rgba(232,48,48,0.08) 35%, rgba(232,48,48,0.12) 60%, rgba(0,0,0,0.35) 100%);
    box-shadow: inset 0 -18px 40px rgba(255,255,255,0.02), 0 16px 40px rgba(0,0,0,0.6);
    transform: translateY(6px);
    pointer-events:none;
  }

  #clickTarget {
    width: clamp(180px, 40vw, 320px);
    height: clamp(180px, 40vw, 320px);
    border-radius:50%;
    object-fit:cover;
    cursor:pointer;
    -webkit-tap-highlight-color: transparent;
    box-shadow: 0 18px 60px rgba(0,0,0,0.6);
    transition: transform .12s ease, filter .12s ease;
    display:block;
    z-index:2;
    background: radial-gradient(circle at 35% 35%, rgba(255,255,255,0.03), transparent 30%);
  }
  #clickTarget.hit { transform: scale(0.94); filter: drop-shadow(0 8px 30px rgba(232,48,48,0.14)); }

  .ripple {
    position:absolute;
    width:16px;
    height:16px;
    border-radius:50%;
    background: rgba(255,255,255,0.18);
    pointer-events:none;
    transform: translate(-50%,-50%) scale(0.2);
    opacity:0.95;
    z-index:3;
    will-change: transform, opacity;
  }
  .float-text {
    position:absolute;
    font-weight:800;
    color:#fff;
    text-shadow:0 6px 18px rgba(0,0,0,0.5);
    pointer-events:none;
    z-index:4;
    will-change: transform, opacity;
  }

  .info-row {
    display:flex;
    align-items:center;
    justify-content:space-between;
    width:100%;
    gap:10px;
    max-width:760px;
    padding:0 14px;
    color:var(--muted);
    font-size:0.95rem;
  }

  .section { display:none; padding:14px 18px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02)); }
  .section.active { display:block; }

  .list { display:flex; flex-direction:column; gap:10px; margin-top:8px; }
  .list .item {
    display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px; border-radius:12px; background: rgba(0,0,0,0.06);
  }
  .item .meta { display:flex; gap:10px; align-items:center; }
  .item img.icon { width:56px; height:56px; border-radius:8px; object-fit:cover; }

  .bottom-nav { position:fixed; left:0; right:0; bottom:8px; display:flex; align-items:center; justify-content:center; z-index:9999; pointer-events:auto; }
  .nav-inner { width: min(920px, calc(100% - 36px)); height: var(--nav-height); background: linear-gradient(90deg, rgba(0,0,0,0.12), rgba(0,0,0,0.06)); border-radius:14px; display:flex; gap:8px; align-items:center; justify-content:space-around; padding:8px; box-shadow: 0 12px 30px rgba(0,0,0,0.35); backdrop-filter: blur(6px); }
  .nav-btn { flex:1; height:100%; display:flex; gap:8px; align-items:center; justify-content:center; flex-direction:column; color:var(--muted); font-weight:700; border-radius:10px; background:transparent; border:0; cursor:pointer; }
  .nav-btn.active { background: linear-gradient(90deg, var(--primary), var(--primary-2)); color:#fff; box-shadow: 0 8px 24px rgba(232,48,48,0.18); }

  .modal-backdrop { position:fixed; left:0; top:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,0.5); z-index:12000; }
  .modal { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); padding:18px; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,0.6); color:#fff; min-width:260px; text-align:center; }
  .modal .ok { margin-top:12px; padding:8px 12px; border-radius:8px; background: linear-gradient(90deg,var(--primary),var(--primary-2)); border:0; color:#fff; font-weight:700; }

  @media (max-width:740px){
    .top { flex-direction:column; gap:8px; align-items:stretch; padding:12px; }
    .main { padding:14px 12px; }
    .target-ring { transform: translateY(4px); }
  }
  @media (max-width:420px){
    #clickTarget { width: clamp(120px, 48vw, 220px); height: clamp(120px, 48vw, 220px); }
    .item img.icon { width:46px; height:46px; }
  }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="ExteraClicker">
    <div class="top">
      <div style="display:flex;gap:12px;align-items:center;">
        <div class="brand">
          <img src="extera.png" alt="Extera" onerror="this.style.display='none'">
          <div>
            <div class="title">ExteraClicker</div>
            <div style="font-size:12px;color:var(--muted)">Тематический кликер для ExteraGram</div>
          </div>
        </div>
        <div class="top-cards" aria-hidden="false">
          <div class="card"><small>Ежедневная</small><b>Награда</b></div>
          <div class="card"><small>Комбо</small><b>Boost</b></div>
        </div>
      </div>

      <div style="display:flex;align-items:center;gap:12px;">
        <div style="display:flex;align-items:center;gap:8px;">
          <img src="coin.png" alt="coin" width="26" height="26" onerror="this.style.display='none'">
          <div id="profitPerHour" style="font-weight:700">+0</div>
        </div>
      </div>
    </div>

    <div class="main" id="mainSection">
      <div class="coin-row">
        <img src="coin.png" alt="coin" onerror="this.style.display='none'">
        <div id="scoreValue">0</div>
        <div style="font-size:0.9rem;color:var(--muted);margin-left:8px;">Extera Coin (экстра коин)</div>
      </div>

      <div class="target-wrap" id="targetWrap">
        <div class="target-ring" id="targetRing" aria-hidden="true"></div>
        <img id="clickTarget" src="click.png" alt="Target" draggable="false" role="button" aria-label="Цель для клика">
      </div>

      <div class="info-row">
        <div>Пассивный доход: <span id="autoValue">0</span>/сек</div>
        <div>COMBO x<span id="comboValue">1</span></div>
        <div><button id="claimDaily" class="btn" style="background:linear-gradient(90deg,var(--primary),var(--primary-2));border:0;color:#fff;font-weight:700;padding:8px 10px;border-radius:10px;">Ежедневная награда</button></div>
      </div>

      <div id="shopSection" class="section" aria-hidden="true">
        <h3 style="margin:8px 0 6px 0;">Магазин — майнеры</h3>
        <div class="list" id="minersShop"></div>
        <h4 style="margin-top:12px;">Скины</h4>
        <div class="list" id="skinsShop"></div>
      </div>

      <div id="upgradesSection" class="section" aria-hidden="true">
        <h3 style="margin:8px 0 6px 0;">Прокачка купленных майнеров</h3>
        <div class="list" id="minersUpgradeList"></div>
        <h4 style="margin-top:12px;">Сила клика</h4>
        <div class="list">
          <div class="item">
            <div>Уровень <span id="clickPowerLevel">0</span></div>
            <div><button id="upgradeClickPower" class="btn">Улучшить (<span id="upgradeClickCost">—</span>)</button></div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <nav class="bottom-nav" role="navigation" aria-label="Навигация">
    <div class="nav-inner" role="tablist">
      <button class="nav-btn active" data-target="main" id="navMain" aria-selected="true"><span class="material-icons">home</span>Главная</button>
      <button class="nav-btn" data-target="shop" id="navShop" aria-selected="false"><span class="material-icons">storefront</span>Магазин</button>
      <button class="nav-btn" data-target="upgrades" id="navUpgrades" aria-selected="false"><span class="material-icons">trending_up</span>Прокачка</button>
    </div>
  </nav>

  <div id="modalRoot" style="display:none;"></div>

<script>
/* ===== STATE & STORAGE ===== */
const KEY = 'exteraclicker_miners_v1';
const defaultState = {
  score: 0,
  clickPowerLevel: 0,
  clickPowerBase: 1,
  combo: 1,
  // availableMiners: уникальные майнеры, их можно купить только 1 раз
  availableMiners: [
    { id:'webdev', name:'Веб-разработчик', cost:1000, baseIncome:5, owned:false, level:0 },
    { id:'btcminer', name:'Майнер биткоинов', cost:10000, baseIncome:10, owned:false, level:0 },
    { id:'gpus', name:'GPU Farm', cost:25000, baseIncome:30, owned:false, level:0 },
    { id:'wind', name:'Ветряк', cost:100000, baseIncome:100, owned:false, level:0 },
    { id:'datacenter', name:'Дата-центр', cost:250000, baseIncome:300, owned:false, level:0 },
    { id:'oil', name:'Нефтяная вышка', cost:1000000, baseIncome:1000, owned:false, level:0 }
  ],
  skins: [
    { id:'default', name:'Default', img:'click.png', cost:0, owned:true },
    { id:'extera', name:'Extera', img:'extera.png', cost:500, owned:false },
    { id:'skin1', name:'Skin 1', img:'skin1.png', cost:800, owned:false }
  ],
  activeSkinId: 'default',
  lastDaily: null
};

function loadState(){ try{ const raw = localStorage.getItem(KEY); if(!raw) return JSON.parse(JSON.stringify(defaultState)); const parsed = JSON.parse(raw); return Object.assign(JSON.parse(JSON.stringify(defaultState)), parsed); }catch(e){ return JSON.parse(JSON.stringify(defaultState)); } }
function saveState(){ localStorage.setItem(KEY, JSON.stringify(state)); }

let state = loadState();

/* ===== UI refs ===== */
const scoreValueEl = document.getElementById('scoreValue');
const profitPerHourEl = document.getElementById('profitPerHour');
const autoValueEl = document.getElementById('autoValue');
const comboValueEl = document.getElementById('comboValue');
const clickTarget = document.getElementById('clickTarget');
const targetWrap = document.getElementById('targetWrap');
const targetRing = document.getElementById('targetRing');

const minersShop = document.getElementById('minersShop');
const skinsShop = document.getElementById('skinsShop');
const minersUpgradeList = document.getElementById('minersUpgradeList');

const navButtons = document.querySelectorAll('.nav-btn');
const mainSection = document.getElementById('mainSection');
const shopSection = document.getElementById('shopSection');
const upgradesSection = document.getElementById('upgradesSection');

const upgradeClickBtn = document.getElementById('upgradeClickPower');
const upgradeClickCostEl = document.getElementById('upgradeClickCost');
const clickPowerLevelEl = document.getElementById('clickPowerLevel');

const claimDailyBtn = document.getElementById('claimDaily');
const modalRoot = document.getElementById('modalRoot');

/* ===== Helpers ===== */
function minerUpgradeCost(miner){ 
  // цена прокачки: базовая цена * 1.35^level
  return Math.floor(miner.cost * Math.pow(1.35, miner.level));
}
function incomePerSec(miner){
  // если не куплен => 0. Если куплен, level >=1
  return miner.owned ? miner.baseIncome * miner.level : 0;
}
function totalAuto(){
  return state.availableMiners.reduce((s,m)=> s + incomePerSec(m), 0) * state.combo;
}
function clickPower(){ return state.clickPowerBase + state.clickPowerLevel; }
function clickPowerUpgradeCost(){ return Math.floor(150 * Math.pow(2, state.clickPowerLevel)); }
function skinById(id){ return state.skins.find(s=>s.id===id); }
function canClaimDaily(){ if(!state.lastDaily) return true; const last=new Date(state.lastDaily); const now=new Date(); return now.toDateString() !== last.toDateString(); }

/* ===== UI update ===== */
function fmt(n){ return Number(n).toLocaleString('ru-RU'); }

function updateUI(){
  scoreValueEl.textContent = fmt(Math.floor(state.score));
  profitPerHourEl && (profitPerHourEl.textContent = `+${fmt(Math.floor(totalAuto()*3600))}`);
  autoValueEl.textContent = `${fmt(Math.floor(totalAuto()))}`;
  comboValueEl.textContent = state.combo.toFixed(2);
  clickPowerLevelEl.textContent = state.clickPowerLevel;
  upgradeClickCostEl.textContent = fmt(clickPowerUpgradeCost());

  // render shop (available miners)
  minersShop.innerHTML = '';
  state.availableMiners.forEach(m=>{
    const item = document.createElement('div');
    item.className = 'item';
    const ownedTag = m.owned ? `<div style="font-size:0.85rem;color:var(--muted);font-weight:700">Куплен</div>` : `<div style="font-size:0.85rem;color:var(--muted)">${fmt(m.baseIncome)}/сек</div>`;
    item.innerHTML = `<div class="meta"><div style="width:56px;height:56px;border-radius:8px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-weight:700">${m.owned ? m.level : ''}</div>
      <div><div style="font-weight:700">${m.name}</div><div style="font-size:13px;color:rgba(255,255,255,0.85)">Цена: ${fmt(m.cost)}</div></div></div>
      <div>${m.owned ? '<button class="btn" disabled>Куплен</button>' : `<button class="btn buyMiner" data-id="${m.id}">Купить</button>`}</div>`;
    minersShop.appendChild(item);
  });

  // skins shop
  skinsShop.innerHTML = '';
  state.skins.forEach(s=>{
    const d = document.createElement('div');
    d.className = 'item';
    d.innerHTML = `<div class="meta"><img class="icon" src="${s.img}" alt="${s.name}" onerror="this.style.filter='grayscale(1)';this.style.opacity=.5">
      <div><div style="font-weight:700">${s.name}${s.id===state.activeSkinId ? ' • Активен' : ''}</div><div style="font-size:13px;color:rgba(255,255,255,0.85)">Цена: ${fmt(s.cost)}</div></div></div>
      <div>${s.owned ? `<button class="btn activateSkin" data-id="${s.id}">${s.id===state.activeSkinId ? 'Активен' : 'Активировать'}</button>` : `<button class="btn buySkin" data-id="${s.id}">Купить</button>`}</div>`;
    skinsShop.appendChild(d);
  });

  // upgrades: show only owned miners (they appear here after purchase)
  minersUpgradeList.innerHTML = '';
  state.availableMiners.filter(m=> m.owned).forEach(m=>{
    const d = document.createElement('div');
    d.className = 'item';
    d.innerHTML = `<div class="meta"><div style="width:56px;height:56px;border-radius:8px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-weight:700">${m.level}</div>
      <div><div style="font-weight:700">${m.name}</div><div style="font-size:13px;color:rgba(255,255,255,0.85)">Доход: ${fmt(m.baseIncome)}×ур (${fmt(incomePerSec(m))}/сек) — Прокачка: ${fmt(minerUpgradeCost(m))}</div></div></div>
      <div><button class="btn upgradeMiner" data-id="${m.id}">Прокачать</button></div>`;
    minersUpgradeList.appendChild(d);
  });

  // enable/disable upgrade buttons
  document.querySelectorAll('.upgradeMiner').forEach(b=>{
    const id = b.dataset.id; const m = state.availableMiners.find(x=>x.id===id);
    b.disabled = state.score < minerUpgradeCost(m);
  });

  document.querySelectorAll('.buyMiner').forEach(b=>{
    const id = b.dataset.id; const m = state.availableMiners.find(x=>x.id===id);
    b.disabled = m.owned || state.score < m.cost;
  });

  document.querySelectorAll('.buySkin').forEach(b=>{
    const id = b.dataset.id; const s = skinById(id); b.disabled = state.score < s.cost;
  });
  document.querySelectorAll('.activateSkin').forEach(b=>{
    const id=b.dataset.id; b.disabled = id===state.activeSkinId;
  });

  upgradeClickBtn.disabled = state.score < clickPowerUpgradeCost();

  saveState();
}

/* ===== Anim scheduler (webp 5-15s) ===== */
const ANIM_MIN_MS = 5000, ANIM_MAX_MS = 15000, ANIM_DURATION_MS = 1200;
let animTimer = null, animEndTimer = null, animPlaying = false;
function scheduleNextAnimation(){ clearTimeout(animTimer); const delay = ANIM_MIN_MS + Math.floor(Math.random() * (ANIM_MAX_MS - ANIM_MIN_MS + 1)); animTimer = setTimeout(()=> playAnimationOnce(), delay); }
function playAnimationOnce(){
  if (animPlaying) return;
  animPlaying = true;
  const webp = 'click.webp';
  const img = new Image();
  img.onload = ()=> { clickTarget.src = webp; clearTimeout(animEndTimer); animEndTimer = setTimeout(()=> { stopAnimationAndShowStatic(); scheduleNextAnimation(); }, ANIM_DURATION_MS); };
  img.onerror = ()=> { animPlaying = false; scheduleNextAnimation(); };
  img.src = webp;
}
function stopAnimationAndShowStatic(){ animPlaying = false; clearTimeout(animTimer); clearTimeout(animEndTimer); setStaticActiveSkin(); scheduleNextAnimation(); }
function setStaticActiveSkin(){ const s = skinById(state.activeSkinId) || skinById('default'); const img = new Image(); img.onload = ()=> { clickTarget.src = s.img; adjustRingSize(); }; img.onerror = ()=> { clickTarget.src = 'click.png'; adjustRingSize(); }; img.src = s.img; }

/* ===== Ring size adjust ===== */
function adjustRingSize(){ requestAnimationFrame(()=> { const rect = clickTarget.getBoundingClientRect(); const w = rect.width || clickTarget.offsetWidth || 220; const size = Math.round(w * 1.18); targetRing.style.width = size + 'px'; targetRing.style.height = size + 'px'; targetRing.style.left = '50%'; targetRing.style.top = '50%'; targetRing.style.transform = 'translate(-50%, -50%)'; }); }
window.addEventListener('resize', adjustRingSize);
clickTarget.addEventListener('load', adjustRingSize);

/* ===== Click effects: ripple + floating text ===== */
function createClickEffects(clientX, clientY, amount){
  const wrapRect = targetWrap.getBoundingClientRect();
  const x = (clientX || (wrapRect.left + wrapRect.width/2)) - wrapRect.left;
  const y = (clientY || (wrapRect.top + wrapRect.height/2)) - wrapRect.top;

  const ripple = document.createElement('div');
  ripple.className = 'ripple';
  ripple.style.left = `${x}px`; ripple.style.top = `${y}px`;
  targetWrap.appendChild(ripple);

  const maxDim = Math.max(wrapRect.width, wrapRect.height) * 1.2;
  ripple.animate([{ transform: 'translate(-50%,-50%) scale(0.2)', opacity: 0.9 }, { transform: `translate(-50%,-50%) scale(${maxDim/16})`, opacity: 0 }], { duration: 600, easing: 'cubic-bezier(.2,.8,.2,1)'});
  setTimeout(()=> ripple.remove(), 650);

  const float = document.createElement('div');
  float.className = 'float-text';
  float.textContent = `+${amount}`;
  float.style.left = `${x}px`; float.style.top = `${y}px`;
  targetWrap.appendChild(float);

  const dir = Math.random() < 0.5 ? -1 : 1;
  const dx = 40 + Math.random() * 30; const dy = 60 + Math.random() * 30;
  float.animate([{ transform: 'translate(-50%, -50%) translate(0,0)', opacity: 1 }, { transform: `translate(-50%, -50%) translate(${dir*dx}px, -${dy}px)`, opacity: 0 }], { duration: 900, easing: 'cubic-bezier(.2,.8,.2,1)'});
  setTimeout(()=> float.remove(), 950);
}

/* ===== Click handling ===== */
function give(n){ state.score += Math.floor(n); updateUI(); }
function onTap(e){
  let cx = e.clientX;
  let cy = e.clientY;
  if (!cx && e.touches && e.touches[0]) { cx = e.touches[0].clientX; cy = e.touches[0].clientY; }
  clickTarget.classList.add('hit'); setTimeout(()=> clickTarget.classList.remove('hit'), 120);
  const points = clickPower();
  give(points);
  stopAnimationAndShowStatic();
  createClickEffects(cx, cy, points);
}
if (window.PointerEvent){
  clickTarget.addEventListener('pointerdown', (e)=>{ e.preventDefault?.(); onTap(e); }, {passive:false});
  clickTarget.addEventListener('contextmenu', e=> e.preventDefault());
} else {
  clickTarget.addEventListener('touchstart', (e)=>{ e.preventDefault(); onTap(e); }, {passive:false});
  clickTarget.addEventListener('click', (e)=> onTap(e));
}
targetWrap.addEventListener('pointerdown', (e)=>{ if (e.target === clickTarget) return; if (e.clientX && e.clientY){ const r = clickTarget.getBoundingClientRect(); if (e.clientX >= r.left && e.clientX <= r.right && e.clientY >= r.top && e.clientY <= r.bottom) onTap(e); } });

/* ===== Shop / Upgrades actions ===== */
document.addEventListener('click', (e)=>{
  const buyMinerBtn = e.target.closest('.buyMiner');
  if (buyMinerBtn){
    const id = buyMinerBtn.dataset.id; const m = state.availableMiners.find(x=>x.id===id);
    if (!m || m.owned) return;
    if (state.score >= m.cost){ state.score -= m.cost; m.owned = true; m.level = 1; updateUI(); showSection('upgrades'); alert(`Куплен майнер: ${m.name}`); }
    else alert('Не хватает очков на покупку майнера.');
    return;
  }

  const upgradeMinerBtn = e.target.closest('.upgradeMiner');
  if (upgradeMinerBtn){
    const id = upgradeMinerBtn.dataset.id; const m = state.availableMiners.find(x=>x.id===id);
    if (!m || !m.owned) return;
    const c = minerUpgradeCost(m);
    if (state.score >= c){ state.score -= c; m.level += 1; updateUI(); }
    else alert('Не хватает очков на прокачку.');
    return;
  }

  const buySkinBtn = e.target.closest('.buySkin');
  if (buySkinBtn){
    const id = buySkinBtn.dataset.id; const s = skinById(id);
    if (!s) return;
    if (state.score >= s.cost){ state.score -= s.cost; s.owned = true; state.activeSkinId = s.id; setStaticActiveSkin(); updateUI(); alert(`Куплен и активирован скин: ${s.name}`); } else alert('Не хватает очков.');
    return;
  }

  const actSkinBtn = e.target.closest('.activateSkin');
  if (actSkinBtn){
    const id = actSkinBtn.dataset.id; const s = skinById(id);
    if (!s || !s.owned) return;
    state.activeSkinId = s.id; setStaticActiveSkin(); updateUI();
    return;
  }
});

/* ===== Daily reward logic (modal) ===== */
function openModal(title, text){ modalRoot.innerHTML = ''; const backdrop = document.createElement('div'); backdrop.className = 'modal-backdrop'; const modal = document.createElement('div'); modal.className = 'modal'; modal.innerHTML = `<div style="font-weight:800;font-size:1.05rem;margin-bottom:6px">${title}</div><div>${text}</div>`; const ok = document.createElement('button'); ok.className='ok'; ok.textContent='ОК'; ok.addEventListener('click', ()=> { modalRoot.style.display='none'; modalRoot.innerHTML=''; }); modal.appendChild(ok); backdrop.appendChild(modal); modalRoot.appendChild(backdrop); modalRoot.style.display='block'; }
claimDailyBtn.addEventListener('click', ()=> {
  if (!canClaimDaily()) { openModal('Ежедневная награда', 'Вы уже получили награду сегодня.'); return; }
  const reward = 500 + Math.floor(Math.random()*500);
  state.score += reward; state.lastDaily = new Date().toISOString(); updateUI(); openModal('Ежедневная награда', `Вы получили ${fmt(reward)} Extera Coin (экстра коин)!`);
});

/* ===== Upgrade click power ===== */
upgradeClickBtn && upgradeClickBtn.addEventListener('click', ()=> { const c = clickPowerUpgradeCost(); if (state.score >= c){ state.score -= c; state.clickPowerLevel += 1; updateUI(); } else alert('Не хватает очков.'); });

/* ===== Passive income ===== */
setInterval(()=> { const per = Math.floor(totalAuto()); if (per > 0){ state.score += per; updateUI(); } }, 1000);

/* ===== Navigation ===== */
function showSection(name){
  navButtons.forEach(b=>{ b.classList.toggle('active', b.dataset.target === name); b.setAttribute('aria-selected', b.dataset.target === name ? 'true' : 'false'); });
  if (name === 'main'){ mainSection.style.display='block'; shopSection.classList.remove('active'); shopSection.setAttribute('aria-hidden','true'); upgradesSection.classList.remove('active'); upgradesSection.setAttribute('aria-hidden','true'); }
  else if (name === 'shop'){ mainSection.style.display='none'; shopSection.classList.add('active'); shopSection.setAttribute('aria-hidden','false'); upgradesSection.classList.remove('active'); upgradesSection.setAttribute('aria-hidden','true'); }
  else if (name === 'upgrades'){ mainSection.style.display='none'; shopSection.classList.remove('active'); shopSection.setAttribute('aria-hidden','true'); upgradesSection.classList.add('active'); upgradesSection.setAttribute('aria-hidden','false'); }
}
navButtons.forEach(b=> b.addEventListener('click', ()=> showSection(b.dataset.target)));
showSection('main');

/* ===== Init ===== */
if (state.score < 100) state.score += 100;
setStaticActiveSkin();
updateUI();
adjustRingSize();
scheduleNextAnimation();
window.addEventListener('beforeunload', ()=> saveState());

</script>
</body>
</html>
